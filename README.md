### Code

+ Framework: [Flask (python)](http://flask.pocoo.org/), Image Editing Library: [Fabric.js (javascript + Canvas)](http://fabricjs.com/)

### Deployment

+ **Database**: install `mysql`, 
```bash
mysql -u root -p                    # logged in as root to create user
```

```sql
-- create user, database if necessary

create user 'testusr'@'localhost' identified by 'testpsd'; -- create 'testusr' with 'testpsd'
create database orasiscloudcad;                         -- create 'testdb' for this project
grant all on orasiscloudcad.* to 'testusr'@'localhost'; -- grant privileges
flush privileges;
show grants for 'testusr'@'localhost';          -- check
```

Exit and now logged in as testusr
```bash
mysql -u testusr -p
```

Create tables:
```bash
mysql -u testusr -p # enter mysql using testpsd
```
after entering mysql,
```sql
use orasiscloudcad;
source orasiscloudcaddbSetUp.sql;
```

Check serve.py file, near line 14 make sure it connects to the right database using right user with right password
```python
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://testusr:testpsd@localhost/orasiscloudcad'
```

+ **Tables**:
    - **celltypes**: `ctid` (cell type id), `ctname` (cell type name), `ctcolor` (cell type color)
    - **users**: `uid` (user id), `email` (user email), `pwdhash` (hash of password)
    - **tasks**: `tid` (task it), `uid` (task owner id), `tname` (task name), `imgnumttl` (number of total images), `imgnummrk` (number of marked images, if you delete all of markers of a image, its status will change from marked to unmarked), `state` (task completed or incompleted)
    - **images**: `iid` (image id), `tid` (task id), `imgname` (image name), `bbx` (json string of all the markers on this image), `bbxnum` (number of markers)

+ **Flask**: install `virtualenv`, suppose `$ORASISROOT` is the web folder, 
```bash
cd $ORASISROOT
virtualenv venv  # this will create a folder venv (virtual environment)
source venv/bin/active  # active virtual environment
pip install -r requirement.txt  # install all the dependencies
python serve.py  # serve the web
```
after this you should be able to visit your web from `127.0.0.1:5000`

+ **Deployment**: to make other machines being able to visit web through your IP, run script `./runapp.sh` (install dependencies if met errors), other machines should be able to visit through `$YOURIP:8000`

### UI Logic

1. create new task (will not switch to newly created task but task list is updated), save image markers and then switch to new task; each new task will create a folder `/static/uploads/taskID` which saves all the uploaded images

2. upload images, you can upload images to a task many times, currently does not support delete images; when upload a image which was uploaded before, it will be ignored unless you change the name of image

3. in preview mode: raw image is always shown as background, can select to show or not show markers; when select to show markers, cell type and intensity are clickable to see what are the markers corresponding to selected cell type and intensities

4. in edit mode: you can select to use circle or rectangle as marker, and select one cell type and one intensity value, then you can mark the cells with that selected cell type and intensity value using the selected marker

5. **Save markers before switching task or image**

6. click `Results` will show results of tasks generated by the logged in user, tasks that have no image uploaded (or have no marked image) have no `download` button

### What's Missing

+ any email can successfully register, no confirmation email was sent

+ delete images from a task, delete task

+ in edit mode, when click a marker, display the type, intensity, position of this marker in some place (left-bottom or above of the image) so user can change those values to only edit the slected marker

+ advanced image processing functions (zoom in/out, gray ...)
